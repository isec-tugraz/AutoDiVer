#!/usr/bin/env python3
"""
Efficient Methods to Search for Best Differential Characteristics on SKINNY
Stephanie Delaune, Patrick Derbez, Paul Huynh, Marine Minier, Victor Mollimard, and Charles Prudâ€™homme

Table 12. The Best TK3 differential characteristics we found on 17 rounds of
SKINNY-128 with probability equal to 2^-110.

https://doi.org/10.1007/978-3-030-78375-4_8
"""

from pathlib import Path
import numpy as np

if __name__ == '__main__':
    sbox_in = np.array(bytearray.fromhex(
        "00000200002000000800000000000808"
        "00100000000008000000000000001000"
        "00000000004000000000001000400000"
        "04400005000000050040040000400005"
        "00040505050400010000000404040005"
        "01000000000101010300010000000101"
        "00B30000200000000000002000002000"
        "00000000000000000000000000800000"
        "03000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000002900000000"
        "00300000000000000030000000300000"
    )).reshape(17, 4, 4)

    sbox_out = np.array(bytearray.fromhex(
        "00000800009200001800000000001010"
        "00400000000010000000000000004000"
        "00000000000400000000004000040000"
        "05040001000000010004010000040005"
        "00010101010100280000000101010001"
        "2000000000202020200020000000B320"
        "00EE0000800000000000008000008000"
        "00000000000000000000000000030000"
        "29000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000000000000000"
        "00000000000000000000003000000000"
        "00400000000000000040000000400000"
    )).reshape(17, 4, 4)

    tweakeys = np.array(bytearray.fromhex(
        "0000000000BA00000000000000000000" "00000000004300000000000000000000" "00000000007300000000000000000000"
        "00000000000000000000000000BA0000" "00000000000000000000000000430000" "00000000000000000000000000730000"
        "000000BA000000000000000000000000" "00000086000000000000000000000000" "00000039000000000000000000000000"
        "0000000000000000000000BA00000000" "00000000000000000000008600000000" "00000000000000000000003900000000"
        "00000000000000BA0000000000000000" "000000000000000D0000000000000000" "000000000000009C0000000000000000"
        "000000000000000000000000000000BA" "0000000000000000000000000000000D" "0000000000000000000000000000009C"
        "00BA0000000000000000000000000000" "001A0000000000000000000000000000" "004E0000000000000000000000000000"
        "000000000000000000BA000000000000" "0000000000000000001A000000000000" "0000000000000000004E000000000000"
        "BA000000000000000000000000000000" "34000000000000000000000000000000" "A7000000000000000000000000000000"
        "0000000000000000BA00000000000000" "00000000000000003400000000000000" "0000000000000000A700000000000000"
        "0000BA00000000000000000000000000" "00006900000000000000000000000000" "0000D300000000000000000000000000"
        "00000000000000000000BA0000000000" "00000000000000000000690000000000" "00000000000000000000D30000000000"
        "00000000BA0000000000000000000000" "00000000D30000000000000000000000" "00000000690000000000000000000000"
        "000000000000000000000000BA000000" "000000000000000000000000D3000000" "00000000000000000000000069000000"
        "000000000000BA000000000000000000" "000000000000A7000000000000000000" "00000000000034000000000000000000"
        "0000000000000000000000000000BA00" "0000000000000000000000000000A700" "00000000000000000000000000003400"
        "0000000000ba00000000000000000000" "00000000004e00000000000000000000" "00000000001a00000000000000000000"
    )).reshape(17, 3, 4, 4)

    script_file = Path(__file__)
    dst_file = script_file.with_suffix('.npz')
    print(f'Writing to {dst_file}')
    np.savez(dst_file, sbox_in=sbox_in, sbox_out=sbox_out, tweakeys=tweakeys)

    # numrounds = len(sbox_in)
    # for i in range(4, numrounds):
    #     dst_file = script_file.with_name(script_file.stem + f'_r{i}.npz')
    #     print(f'Writing to {dst_file}')
    #     np.savez(dst_file, sbox_in=sbox_in[:i], sbox_out=sbox_out[:i], tweakeys=tweakeys[:i])
