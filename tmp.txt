perm_layer = np.array((0, 17, 34, 51, 48, 1, 18, 35, 32, 49, 2, 19, 16, 33, 50, 3,
                       4, 21, 38, 55, 52, 5, 22, 39, 36, 53, 6, 23, 20, 37, 54, 7,
                       8, 25, 42, 59, 56, 9, 26, 43, 40, 57, 10, 27, 24, 41, 58, 11,
                       12, 29, 46, 63, 60, 13, 30, 47, 44, 61, 14, 31, 28, 45, 62, 15))
In [9]: out = indices.sbox_out_val[0]
In [10]: flat_out = out.flatten()
In [11]: permuted = flat_out[perm_layer]
In [12]: permuted_grouped = permuted.reshape(16, 4)
In [13]: out
Out[13]:
array([[321, 322, 323, 324],
       [325, 326, 327, 328],
       [329, 330, 331, 332],
       [333, 334, 335, 336],
       [337, 338, 339, 340],
       [341, 342, 343, 344],
       [345, 346, 347, 348],
       [349, 350, 351, 352],
       [353, 354, 355, 356],
       [357, 358, 359, 360],
       [361, 362, 363, 364],
       [365, 366, 367, 368],
       [369, 370, 371, 372],
       [373, 374, 375, 376],
       [377, 378, 379, 380],
       [381, 382, 383, 384]], dtype=int32)
In [14]: permuted_grouped
Out[14]:
array([[321, 338, 355, 372],
       [369, 322, 339, 356],
       [353, 370, 323, 340],
       [337, 354, 371, 324],
       [325, 342, 359, 376],
       [373, 326, 343, 360],
       [357, 374, 327, 344],
       [341, 358, 375, 328],
       [329, 346, 363, 380],
       [377, 330, 347, 364],
       [361, 378, 331, 348],
       [345, 362, 379, 332],
       [333, 350, 367, 384],
       [381, 334, 351, 368],
       [365, 382, 335, 352],
       [349, 366, 383, 336]], dtype=int32)